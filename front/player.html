<!DOCTYPE html>
<html lang="en">
<head>

  <link rel="stylesheet" type="text/css" href="/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/css/foundation.min.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">


</head>
<body>

<div class="row">
<br/>
<p style="font-size: 3em;">Pour choisir la musique ca se passe sur <strong>http://bit.ly/playlistcoloc</strong></p>
<br/>
</div>

<div id="dz-root"></div>

<br/>
<br/>
<br/>

<div id="player" style="width:100%;" align="center"></div>


<br/>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="http://cdn-files.deezer.com/js/min/dz.js"></script>

<script>

  window.changingTrack = false;
  window.trackStarted = false;


  function nextTrack(){
    if (changingTrack) {
      return;
    }
    changingTrack = true;

    $.ajax({
      url: '/room/myroom/top',
      type: 'DELETE',
      success: function(trackId)({
        DZ.player.playTracks([trackId]);
      });
    });
  };

  function onPlayerPos(position){
    // Pos > 0 : track started
    if (position > 0 && !trackStarted) {
      trackStarted = true;
      changingTrack = false; // Now, nextTrack can be called again
    }

    // Pos = 0 and track started => it has ended
    if (position == 0 && trackStarted) {
      trackStarted = false;
      nextTrack();
    }
  };

  function onPlayerLoaded() {

    DZ.Event.subscribe('player_position', function(pos){
      onPlayerPos(pos[0]);
    });

    nextTrack();
  }

  DZ.init({
    appId  : '133181',
    channelUrl : 'http://playlist.mru2.com/channel.html',
    player : {
      container : 'player',
      cover : true,
      width : 1000,
      height : 80,
      playlist: false,
      onload : onPlayerLoaded
    }
  });

  DZ.login(function(response) {
    if (response.authResponse) {
      console.log('Welcome!  Fetching your information.... ');
      DZ.api('/user/me', function(response) {
        console.log('Good to see you, ' + response.name + '.');
      });
    } else {
      console.log('User cancelled login or did not fully authorize.');
    }
  }, {perms: 'manage_library,delete_library'});


</script>

</body>
</html>